<!doctype html>
<html lang="hi" class="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>
      <span class="lang-hi">बिहार वर्षा मानचित्र विश्लेषण</span> <span
      class="lang-en">Bihar Rainfall Map Analysis</span>
    </title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              primary: "#2E8B57",
              secondary: "#E6F4EA",
              darkbg: "#1a202c",
              carddark: "#2d3748",
            },
          },
        },
      };
    </script>

    <style>
      @import url("https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Tiro+Devanagari+Hindi&display=swap");

      body {
        font-family: "Poppins", "Tiro Devanagari Hindi", sans-serif;
        scroll-behavior: smooth;
      }

      /* Custom Scrollbar */
      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }
      ::-webkit-scrollbar-track {
        background: #f1f1f1;
      }
      ::-webkit-scrollbar-thumb {
        background: #888;
        border-radius: 4px;
      }
      .dark ::-webkit-scrollbar-track {
        background: #2d3748;
      }

      /* Language specific elements - Default to Hindi */
      .lang-en {
        display: none !important;
      }
      .lang-hi {
        display: block !important;
      }

      body.english .lang-en {
        display: block !important;
      }
      body.english .lang-hi {
        display: none !important;
      }

      /* --- Navbar Style --- */
      .navbar {
        background-color: rgba(255, 255, 255, 0.8);
        backdrop-filter: blur(10px);
        box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
        position: fixed !important;
        top: 0;
        left: 0;
        right: 0;
        width: 100%;
        z-index: 1000 !important;
      }

      /* बॉडी को और नीचे धकेला गया है (Tiro Font के लिए) */
      body {
        padding-top: 180px !important; /* कंप्यूटर के लिए गैप बढ़ाया गया */
      }

      @media (max-width: 1023px) {
        body {
          padding-top: 220px !important; /* मोबाइल के लिए गैप बढ़ाया गया */
        }
      }

      /* हेडर का एडजस्टमेंट */
      #overview {
        padding-top: 0 !important;
        margin-top: -20px !important;
      }

      /* फ़ॉन्ट की ऊंचाई को संतुलित करने के लिए */
      h2,
      .gradient-text {
        line-height: 1.5 !important;
        padding-top: 5px;
      }

      .dark .navbar {
        background-color: rgba(30, 41, 59, 0.9) !important;
      }

      /* --- Gradient Text --- */
      .gradient-text {
        background: linear-gradient(
          to right,
          #2563eb,
          #0d9488
        ); /* Blue to Teal */
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        display: inline-block;
      }
      .dark .gradient-text {
        background: linear-gradient(to right, #60a5fa, #2dd4bf);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      /* --- Nav Box Style --- */
      .nav-box {
        padding: 0.5rem 1rem;
        border-radius: 0.5rem;
        transition: all 0.3s ease;
        font-weight: 600;
        cursor: pointer;
        border: 1px solid transparent;
        color: #4b5563;
        text-decoration: none;
        display: inline-block;
        min-width: 110px; /* Fixed width for seamless transition */
        text-align: center;
        justify-content: center;
      }
      .dark .nav-box {
        color: #d1d5db;
      }

      .nav-box:hover {
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        transform: translateY(-2px);
        background-color: white;
      }
      .dark .nav-box:hover {
        background-color: #374151;
      }

      .nav-box.active-nav {
        background: linear-gradient(to right, #2563eb, #0d9488);
        color: white !important;
        box-shadow: 0 10px 15px -3px rgba(37, 99, 235, 0.3);
        border: none;
      }

      /* --- Month Tabs Style --- */
      .month-tab {
        padding: 0.5rem 1.2rem;
        border-radius: 9999px; /* Pill shape */
        font-size: 0.875rem;
        font-weight: 600;
        transition: all 0.2s ease;
        border: 1px solid #e5e7eb;
        background-color: white;
        color: #4b5563;
        cursor: pointer;
      }
      .dark .month-tab {
        background-color: #1f2937;
        border-color: #374151;
        color: #d1d5db;
      }
      .month-tab:hover {
        background-color: #f3f4f6;
        transform: translateY(-1px);
      }
      .dark .month-tab:hover {
        background-color: #374151;
      }

      .month-tab.active-tab {
        background: linear-gradient(to right, #2563eb, #0d9488);
        color: white;
        border-color: transparent;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      }

      /* Language Switcher Styles */
      /* --- New Language Toggle Switch --- */
      .lang-switch-wrapper {
        display: flex;
        align-items: center;
        gap: 6px;
        background: rgba(255, 255, 255, 0.6);
        padding: 4px 8px;
        border-radius: 20px;
        border: 1px solid rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(4px);
      }
      .dark .lang-switch-wrapper {
        background: rgba(30, 41, 59, 0.6);
        border-color: rgba(255, 255, 255, 0.1);
      }
      .lang-label {
        font-size: 0.75rem;
        font-weight: 700;
        color: #64748b;
        cursor: pointer;
        opacity: 0.5;
        transition: all 0.3s;
        user-select: none;
      }
      .dark .lang-label {
        color: #94a3b8;
      }
      .lang-label.active {
        opacity: 1;
        color: #2563eb;
      }
      .dark .lang-label.active {
        color: #60a5fa;
      }

      .toggle-switch {
        position: relative;
        width: 36px;
        height: 20px;
        display: inline-block;
      }
      .toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }
      .toggle-slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #cbd5e1;
        transition: 0.4s;
        border-radius: 20px;
      }
      .dark .toggle-slider {
        background-color: #475569;
      }
      .toggle-slider:before {
        position: absolute;
        content: "";
        height: 16px;
        width: 16px;
        left: 2px;
        bottom: 2px;
        background-color: white;
        transition: 0.4s;
        border-radius: 50%;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
      }
      .toggle-switch input:checked + .toggle-slider {
        background-color: #2563eb;
      }
      .toggle-switch input:checked + .toggle-slider:before {
        transform: translateX(16px);
      }

      /* Responsive Navigation */
      .nav-links-container {
        display: flex;
        gap: 1rem;
        align-items: center;
      }
      @media (max-width: 1023px) {
        .nav-links-container {
          gap: 0.5rem;
          overflow-x: auto;
          white-space: nowrap;
          padding-bottom: 4px;
          flex-grow: 1;
          justify-content: flex-start;
        }
      }

      /* --- Weather Background Animation --- */
      /* Body Background (Day Mode) */
      body {
        /* Animated Blue Sky Gradient */
        background: linear-gradient(-45deg, #87ceeb, #00bfff, #1e90ff, #87cefa);
        background-size: 400% 400%;
        animation: gradientBG 15s ease infinite;
        background-attachment: fixed;
        min-height: 100vh;
        margin: 0;
      }

      @keyframes gradientBG {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }

      /* Weather Background Container */
      .weather-bg {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
        overflow: hidden;
        pointer-events: none;
      }

      /* Sun & Clouds (Day Elements) */
      .sun {
        position: absolute;
        top: -60px;
        right: -60px;
        width: 250px;
        height: 250px;
        background: radial-gradient(
          circle,
          rgba(255, 255, 220, 0.6) 0%,
          rgba(255, 255, 255, 0) 70%
        );
        border-radius: 50%;
        filter: blur(30px);
        animation: sun-pulse 8s infinite alternate;
        transition:
          opacity 1s ease,
          transform 1s ease;
      }

      .cloud {
        position: absolute;
        background: rgba(255, 255, 255, 0.5);
        border-radius: 50px;
        filter: blur(8px);
        transition: opacity 1s ease;
      }

      .cloud::after,
      .cloud::before {
        content: "";
        position: absolute;
        background: inherit;
        border-radius: 50%;
      }

      .cloud1 {
        width: 140px;
        height: 50px;
        top: 10%;
        left: -160px;
        animation: float-cloud 35s infinite linear;
      }
      .cloud1::after {
        width: 60px;
        height: 60px;
        top: -30px;
        left: 25px;
      }
      .cloud1::before {
        width: 50px;
        height: 50px;
        top: -20px;
        left: 70px;
      }

      .cloud2 {
        width: 100px;
        height: 40px;
        top: 25%;
        left: -120px;
        animation: float-cloud 45s infinite linear 12s;
      }
      .cloud2::after {
        width: 45px;
        height: 45px;
        top: -25px;
        left: 15px;
      }
      .cloud2::before {
        width: 40px;
        height: 40px;
        top: -15px;
        left: 50px;
      }

      .cloud3 {
        width: 180px;
        height: 60px;
        top: 15%;
        left: -200px;
        animation: float-cloud 50s infinite linear 5s;
      }
      .cloud3::after {
        width: 80px;
        height: 80px;
        top: -40px;
        left: 30px;
      }
      .cloud3::before {
        width: 60px;
        height: 60px;
        top: -25px;
        left: 90px;
      }

      @keyframes float-cloud {
        0% {
          transform: translateX(0);
        }
        100% {
          transform: translateX(120vw);
        }
      }

      @keyframes sun-pulse {
        0% {
          transform: scale(1);
          opacity: 0.5;
        }
        100% {
          transform: scale(1.1);
          opacity: 0.7;
        }
      }

      /* Moon & Stars (Night Elements) */
      .moon {
        position: absolute;
        top: 60px;
        right: 80px;
        width: 100px;
        height: 100px;
        border-radius: 50%;
        box-shadow: -20px 10px 0 0 #f6e58d;
        opacity: 0;
        transform: translateY(-50px) rotate(-20deg);
        transition: all 1s ease;
      }

      .star {
        position: absolute;
        background: white;
        border-radius: 50%;
        opacity: 0;
        transition: opacity 1s ease;
        box-shadow: 0 0 5px rgba(255, 255, 255, 0.8);
      }

      .star1 {
        width: 3px;
        height: 3px;
        top: 15%;
        left: 10%;
        animation-delay: 0s;
      }
      .star2 {
        width: 4px;
        height: 4px;
        top: 25%;
        left: 30%;
        animation-delay: 1s;
      }
      .star3 {
        width: 2px;
        height: 2px;
        top: 10%;
        left: 50%;
        animation-delay: 2s;
      }
      .star4 {
        width: 3px;
        height: 3px;
        top: 35%;
        left: 70%;
        animation-delay: 0.5s;
      }
      .star5 {
        width: 4px;
        height: 4px;
        top: 20%;
        left: 85%;
        animation-delay: 1.5s;
      }
      .star6 {
        width: 2px;
        height: 2px;
        top: 45%;
        left: 20%;
        animation-delay: 2.5s;
      }
      .star7 {
        width: 3px;
        height: 3px;
        top: 5%;
        left: 60%;
        animation-delay: 0.8s;
      }

      /* Dark Mode Styles (Night Theme) */
      .dark body {
        background: linear-gradient(-45deg, #0f2027, #203a43, #2c5364, #000000);
        background-size: 400% 400%;
        animation: gradientBG 15s ease infinite;
      }

      .dark .sun {
        opacity: 0;
        transform: translateY(50px);
      }
      .dark .cloud {
        opacity: 0;
      }
      .dark .moon {
        opacity: 1;
        transform: translateY(0) rotate(-20deg);
      }
      .dark .star {
        animation: twinkle 3s infinite ease-in-out;
        opacity: 1;
      }

      /* Simple Background Mode */
      body.simple-bg {
        background: #f0f9ff !important;
        animation: none !important;
      }
      .dark body.simple-bg {
        background: #111827 !important;
      }
      body.simple-bg .weather-bg {
        display: none !important;
      }
    </style>
  </head>
  <body
    class="text-gray-800 dark:text-gray-100 transition-colors duration-300 min-h-screen flex flex-col"
  >
    <div class="weather-bg">
      <div class="sun"></div>
      <div class="cloud cloud1"></div>
      <div class="cloud cloud2"></div>
      <div class="cloud cloud3"></div>
      <div class="moon"></div>
      <div class="star star1"></div>
      <div class="star star2"></div>
      <div class="star star3"></div>
      <div class="star star4"></div>
      <div class="star star5"></div>
      <div class="star star6"></div>
      <div class="star star7"></div>
    </div>

    <nav id="navbar" class="navbar">
      <div class="max-w-7xl mx-auto px-4 py-2 flex flex-col gap-2">
        <!-- Top Row -->
        <div class="flex flex-wrap items-center justify-between w-full gap-4">
          <div class="flex items-center gap-3 nav-logo shrink-0">
            <img
              src="assets/logo.png"
              alt="IMD Logo"
              class="h-8 w-8 object-contain dark:invert hidden sm:block"
            />

            <div class="text-3xl text-blue-600 dark:text-blue-400">
              <i class="fa-solid fa-cloud-showers-heavy"></i>
            </div>
            <div>
              <div class="lang-hi">
                <h1 class="text-xl font-bold leading-tight gradient-text">
                  बिहार मानसून डैशबोर्ड
                </h1>
                <div class="text-xs text-gray-500 dark:text-gray-400">
                  IMD MC Patna — व्यापक विश्लेषण
                </div>
              </div>
              <div class="lang-en">
                <h1 class="text-xl font-bold leading-tight gradient-text">
                  Bihar Monsoon Dashboard
                </h1>
                <div class="text-xs text-gray-500 dark:text-gray-400">
                  IMD MC Patna — Comprehensive Analysis
                </div>
              </div>
            </div>
          </div>

          <div class="flex items-center gap-4 shrink-0">
            <!-- Language Switcher -->
            <div class="lang-switch-wrapper">
              <span
                class="lang-label active"
                id="lblHi"
                onclick="
                  document.getElementById('langToggle').checked = false;
                  toggleLanguage();
                "
                >HI</span
              >
              <label class="toggle-switch">
                <input
                  type="checkbox"
                  id="langToggle"
                  onchange="toggleLanguage()"
                />
                <span class="toggle-slider"></span>
              </label>
              <span
                class="lang-label"
                id="lblEn"
                onclick="
                  document.getElementById('langToggle').checked = true;
                  toggleLanguage();
                "
                >EN</span
              >
            </div>

            <button
              id="bgToggleBtn"
              onclick="toggleBackground()"
              class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition"
              title="Toggle Background / बैकग्राउंड बदलें"
            >
              <i class="fa-solid fa-image text-blue-500 dark:text-blue-300"></i>
            </button>

            <button
              onclick="toggleDarkMode()"
              class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition"
            >
              <i class="fa-solid fa-moon dark:hidden text-gray-600"></i>
              <i class="fa-solid fa-sun hidden dark:block text-yellow-400"></i>
            </button>
          </div>
        </div>

        <!-- Bottom Row: Nav Links -->
        <div class="flex justify-center w-full overflow-x-auto pb-1">
          <div class="flex nav-links-container text-sm font-semibold gap-4">
            <a
              href="index.html"
              class="nav-box lang-hi"
              onclick="setActive(this)"
              >होम</a
            >
            <a
              href="index.html"
              class="nav-box lang-en"
              onclick="setActive(this)"
              >Home</a
            >

            <a
              href="district.html"
              class="nav-box lang-hi"
              onclick="setActive(this)"
              >जिलावार</a
            >
            <a
              href="district.html"
              class="nav-box lang-en"
              onclick="setActive(this)"
              >District-wise</a
            >

            <a
              href="intensity.html"
              class="nav-box lang-hi"
              onclick="setActive(this)"
              >तीव्रता</a
            >
            <a
              href="intensity.html"
              class="nav-box lang-en"
              onclick="setActive(this)"
              >Intensity</a
            >

            <a
              href="maps.html"
              class="nav-box active-nav lang-hi"
              onclick="setActive(this)"
              >मानचित्र</a
            >
            <a
              href="maps.html"
              class="nav-box active-nav lang-en"
              onclick="setActive(this)"
              >Maps</a
            >

            <a
              href="history.html"
              class="nav-box lang-hi"
              onclick="setActive(this)"
              >ऐतिहासिक</a
            >
            <a
              href="history.html"
              class="nav-box lang-en"
              onclick="setActive(this)"
              >Historical</a
            >

            <a
              href="comparison.html"
              class="nav-box lang-hi"
              onclick="setActive(this)"
              >तुलना</a
            >
            <a
              href="comparison.html"
              class="nav-box lang-en"
              onclick="setActive(this)"
              >Comparison</a
            >
          </div>
        </div>
      </div>
    </nav>

    <main class="max-w-7xl mx-auto p-6 flex-grow flex flex-col w-full">
      <div
        class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-100 dark:border-gray-700 mb-8"
      >
        <div
          class="flex flex-col md:flex-row justify-between items-start md:items-center gap-6"
        >
          <div>
            <div class="lang-hi">
              <h2 class="text-2xl font-bold flex items-center gap-2 mb-1">
                <i class="fa-solid fa-map-location-dot text-blue-600"></i>
                <span class="gradient-text">वर्षा मानचित्र विश्लेषण</span>
              </h2>
              <p class="text-sm text-gray-500 dark:text-gray-400">
                विभिन्न वर्षों और महीनों के लिए स्थानिक वितरण देखें।
              </p>
            </div>
            <div class="lang-en">
              <h2 class="text-2xl font-bold flex items-center gap-2 mb-1">
                <i class="fa-solid fa-map-location-dot text-blue-600"></i>
                <span class="gradient-text">Rainfall Map Analysis</span>
              </h2>
              <p class="text-sm text-gray-500 dark:text-gray-400">
                View spatial distribution for different years and months.
              </p>
            </div>
          </div>

          <div
            class="flex items-center gap-3 bg-gray-50 dark:bg-gray-700/50 p-2 rounded-lg border border-gray-200 dark:border-gray-600"
          >
            <div class="lang-hi">
              <label
                class="text-sm font-semibold text-gray-500 dark:text-gray-400 px-2"
                >वर्ष:</label
              >
            </div>
            <div class="lang-en">
              <label
                class="text-sm font-semibold text-gray-500 dark:text-gray-400 px-2"
                >Year:</label
              >
            </div>
            <select
              id="mapYear"
              onchange="updateMap()"
              class="bg-white dark:bg-gray-800 border-none rounded-md px-3 py-1 text-sm font-bold focus:ring-2 focus:ring-blue-500 shadow-sm cursor-pointer min-w-[100px]"
            >
              <option value="2025">2025</option>
              <option value="2024">2024</option>
              <option value="2023">2023</option>
              <option value="2022">2022</option>
              <option value="2021">2021</option>
              <option value="2020">2020</option>
              <option value="2019">2019</option>
              <option value="2018">2018</option>
              <option value="2017">2017</option>
              <option value="2016">2016</option>
              <option value="2015">2015</option>
            </select>
          </div>
        </div>

        <hr class="my-4 border-gray-100 dark:border-gray-700" />

        <div class="flex flex-wrap gap-3" id="monthTabsContainer">
          <!-- Hindi Month Tabs -->
          <div class="lang-hi">
            <button
              onclick="selectMonth('Overall')"
              class="month-tab active-tab"
              data-month="Overall"
            >
              मानसून (जून-सितंबर)
            </button>
            <button
              onclick="selectMonth('June')"
              class="month-tab"
              data-month="June"
            >
              जून
            </button>
            <button
              onclick="selectMonth('July')"
              class="month-tab"
              data-month="July"
            >
              जुलाई
            </button>
            <button
              onclick="selectMonth('August')"
              class="month-tab"
              data-month="August"
            >
              अगस्त
            </button>
            <button
              onclick="selectMonth('September')"
              class="month-tab"
              data-month="September"
            >
              सितंबर
            </button>
          </div>

          <!-- English Month Tabs -->
          <div class="lang-en">
            <button
              onclick="selectMonth('Overall')"
              class="month-tab"
              data-month="Overall"
            >
              Monsoon (June-September)
            </button>
            <button
              onclick="selectMonth('June')"
              class="month-tab"
              data-month="June"
            >
              June
            </button>
            <button
              onclick="selectMonth('July')"
              class="month-tab"
              data-month="July"
            >
              July
            </button>
            <button
              onclick="selectMonth('August')"
              class="month-tab"
              data-month="August"
            >
              August
            </button>
            <button
              onclick="selectMonth('September')"
              class="month-tab"
              data-month="September"
            >
              September
            </button>
          </div>
        </div>
      </div>

      <div
        id="mapContainer"
        class="card p-4 bg-white dark:bg-gray-800 rounded-xl shadow-lg min-h-[600px] flex items-center justify-center border border-gray-100 dark:border-gray-700 relative overflow-hidden group"
      >
        <div
          id="mapNotice"
          class="text-center text-gray-500 dark:text-gray-400 py-10 font-medium"
        >
          <i class="fa-solid fa-spinner fa-spin text-3xl mb-3 text-blue-500"></i
          ><br />
          <span class="lang-hi">मानचित्र लोड किया जा रहा है...</span>
          <span class="lang-en">Loading map...</span>
        </div>

        <img
          id="mapView"
          class="mx-auto max-w-full max-h-[80vh] h-auto hidden rounded-lg shadow-sm transition-transform duration-500 group-hover:scale-[1.01]"
          alt="वर्षा मानचित्र छवि"
          onload="onImageLoad()"
          onerror="onImageError()"
        />

        <div
          class="absolute bottom-6 right-6 bg-white/90 dark:bg-gray-900/90 backdrop-blur px-4 py-2 rounded-lg shadow text-sm font-bold border border-gray-200 dark:border-gray-600"
        >
          <div class="lang-hi">
            <span id="labelYear">2025</span> -
            <span id="labelMonth" class="text-blue-600">Overall</span>
          </div>
          <div class="lang-en">
            <span id="labelYear">2025</span> -
            <span id="labelMonth" class="text-blue-600">Total</span>
          </div>
        </div>
      </div>

      <footer
        class="bg-slate-800 text-white p-8 rounded-xl mt-auto text-center space-y-4 !mt-auto"
      >
        <h4 class="text-xl font-bold gradient-text lang-hi">
          डेटा स्रोत और क्रेडिट
        </h4>
        <h4 class="text-xl font-bold gradient-text lang-en">
          Data Source and Credits
        </h4>
        <p class="text-gray-300 lang-hi">
          India Meteorological Department: Meteorological Centre Patna
        </p>
        <p class="text-gray-300 lang-en">
          India Meteorological Department: Meteorological Centre Patna
        </p>
        <div class="pt-4 border-t border-slate-700">
          <p class="text-sm text-gray-400 lang-hi">विश्लेषण तैयार किया गया:</p>
          <p class="text-sm text-gray-400 lang-en">Analysis Prepared by:</p>
          <p class="text-lg font-semibold">© Lal Kamal</p>
        </div>
      </footer>
    </main>

    <script>
      // --- Configuration based on file structure ---
      const mapFiles = {
        Overall: "monsoon_overall_map.png",
        June: "june_map.png",
        July: "july_map.png",
        August: "aug_map.png",
        September: "sep_map.png",
      };

      let currentYear = "2025";
      let currentMonth = "Overall";
      let currentLanguage = "hi"; // Default to Hindi

      // --- Language Switching ---
      function toggleLanguage() {
        const toggle = document.getElementById("langToggle");
        const isEnglish = toggle.checked;
        currentLanguage = isEnglish ? "en" : "hi";

        if (isEnglish) {
          document.body.classList.add("english");
          document.getElementById("lblEn").classList.add("active");
          document.getElementById("lblHi").classList.remove("active");
        } else {
          document.body.classList.remove("english");
          document.getElementById("lblHi").classList.add("active");
          document.getElementById("lblEn").classList.remove("active");
        }

        updateLanguageContent();
      }

      function updateLanguageContent() {
        const isEnglish = currentLanguage === "en";

        // Update page title
        document.title = isEnglish
          ? "Bihar Rainfall Map Analysis"
          : "बिहार वर्षा मानचित्र विश्लेषण";

        // Update dynamic content
        updateMonthLabel();

        // Fix the active tab display issue
        updateActiveTabDisplay();
      }

      function updateActiveTabDisplay() {
        // Get all month tabs
        const allTabs = document.querySelectorAll(".month-tab");

        // First, remove active-tab class from all tabs
        allTabs.forEach((tab) => {
          tab.classList.remove("active-tab");
        });

        // Then, add active-tab class only to the tabs matching current month and language
        const activeTabs = document.querySelectorAll(
          `[data-month="${currentMonth}"]`,
        );
        activeTabs.forEach((tab) => {
          if (
            (currentLanguage === "hi" &&
              tab.parentElement.classList.contains("lang-hi")) ||
            (currentLanguage === "en" &&
              tab.parentElement.classList.contains("lang-en"))
          ) {
            tab.classList.add("active-tab");
          }
        });
      }

      function updateMonthLabel() {
        const monthMap = {
          Overall: { hi: "कुल", en: "Total" },
          June: { hi: "जून", en: "June" },
          July: { hi: "जुलाई", en: "July" },
          August: { hi: "अगस्त", en: "August" },
          September: { hi: "सितंबर", en: "September" },
        };

        const labelElement = document.getElementById("labelMonth");
        if (labelElement) {
          labelElement.textContent = monthMap[currentMonth][currentLanguage];
        }
      }

      // --- Core Functions ---

      function selectMonth(month) {
        currentMonth = month;

        // Update Tab UI - fix for language switching
        updateActiveTabDisplay();

        // Update Labels
        updateMonthLabel();

        // Load Map
        updateMap();
      }

      function updateMap() {
        const yearSelect = document.getElementById("mapYear");
        currentYear = yearSelect.value;
        document.getElementById("labelYear").innerText = currentYear;

        const img = document.getElementById("mapView");
        const notice = document.getElementById("mapNotice");

        // Reset State
        img.classList.add("hidden");
        notice.classList.remove("hidden");

        const loadingText =
          currentLanguage === "en"
            ? "Loading map..."
            : "मानचित्र लोड किया जा रहा है...";
        notice.innerHTML = `<i class="fa-solid fa-spinner fa-spin text-3xl mb-3 text-blue-500"></i><br>${loadingText}`;

        // Construct Path: maps/{year}/{filename}
        const fileName = mapFiles[currentMonth];
        const imagePath = `maps/${currentYear}/${fileName}`;

        // Set Source
        img.src = imagePath;
      }

      // --- Image Event Handlers ---

      function onImageLoad() {
        const img = document.getElementById("mapView");
        const notice = document.getElementById("mapNotice");

        notice.classList.add("hidden");
        img.classList.remove("hidden");
        // Simple fade-in animation
        img.style.opacity = 0;
        setTimeout(() => (img.style.opacity = 1), 50);
      }

      function onImageError() {
        const img = document.getElementById("mapView");
        const notice = document.getElementById("mapNotice");

        img.classList.add("hidden");
        notice.classList.remove("hidden");

        const errorText =
          currentLanguage === "en"
            ? "Map not available."
            : "मानचित्र उपलब्ध नहीं है।";
        const monthText =
          currentLanguage === "en" ? currentMonth : getHindiMonth(currentMonth);

        notice.innerHTML = `
            <div class="text-red-500">
                <i class="fa-solid fa-triangle-exclamation text-4xl mb-2"></i><br>
                ${errorText}<br>
                <span class="text-xs text-gray-400 mt-2 block">(${monthText} ${currentYear})</span>
            </div>
        `;
      }

      function getHindiMonth(month) {
        const monthMap = {
          Overall: "कुल",
          June: "जून",
          July: "जुलाई",
          August: "अगस्त",
          September: "सितंबर",
        };
        return monthMap[month] || month;
      }

      // --- Background Toggle ---
      function toggleBackground() {
        document.body.classList.toggle("simple-bg");
        const isSimple = document.body.classList.contains("simple-bg");
        localStorage.setItem("simpleBackground", isSimple ? "true" : "false");
        updateBackgroundBtnIcon(isSimple);
      }

      function updateBackgroundBtnIcon(isSimple) {
        const btn = document.getElementById("bgToggleBtn");
        if (!btn) return;
        if (isSimple) {
          btn.innerHTML = '<i class="fa-solid fa-ban text-gray-400"></i>';
        } else {
          btn.innerHTML =
            '<i class="fa-solid fa-image text-blue-500 dark:text-blue-300"></i>';
        }
      }

      // --- General Logic ---

      function toggleDarkMode() {
        document.documentElement.classList.toggle("dark");
      }

      function setActive(element) {
        document
          .querySelectorAll(".nav-box")
          .forEach((el) => el.classList.remove("active-nav"));
        element.classList.add("active-nav");
      }

      // Init
      document.addEventListener("DOMContentLoaded", () => {
        // Set default language to Hindi
        document.body.classList.add("hindi");
        currentLanguage = "hi";

        // Set up language switcher state
        const toggle = document.getElementById("langToggle");
        if (toggle) toggle.checked = false;

        // Ensure default year 2025 is selected
        const yearSelect = document.getElementById("mapYear");
        if (!yearSelect.value) yearSelect.value = "2025";

        // Initialize with proper language display
        updateLanguageContent();
        updateMap();

        const savedSimple = localStorage.getItem("simpleBackground") === "true";
        if (savedSimple) {
          document.body.classList.add("simple-bg");
        }
        updateBackgroundBtnIcon(savedSimple);
      });
    </script>
  </body>
</html>
